# Админка для управления сервисами

Система админки позволяет управлять доступностью различных сервисов бота как глобально, так и для отдельных пользователей.

## Возможности

### Глобальное управление
- Включение/отключение сервисов для всех пользователей
- Просмотр статуса всех сервисов
- Сброс настроек к значениям по умолчанию

### Индивидуальное управление
- Настройка доступности сервисов для конкретных пользователей
- Переопределение глобальных настроек
- Удаление индивидуальных настроек

## Доступные сервисы

- **set_cashback** - Установка процентов кэшбэка (`/set_cashback`)
- **my_cashback** - Просмотр настроек кэшбэка (`/my_cashback`)
- **remove_cashback** - Удаление настроек кэшбэка (`/remove_cashback`)
- **search** - Поиск категорий и MCC-кодов (`/search`)
- **favorites** - Управление избранными категориями (`/favorites`)
- **subscription** - Управление подпиской (`/subscription`)
- **stats** - Статистика пользователя (`/stats`)
- **banks** - Список доступных банков (`/banks`)

## Команды админки

### `/admin_services`
Основная команда для управления сервисами. Открывает меню с:
- Список всех сервисов для настройки
- Просмотр статуса всех сервисов
- Сброс настроек

### Глобальные настройки
1. Выберите сервис из списка
2. Нажмите "Включить глобально" или "Отключить глобально"
3. Изменение влияет на всех пользователей

### Индивидуальные настройки
1. Выберите сервис из списка
2. Нажмите "Настройки для пользователя"
3. Введите Telegram ID пользователя
4. Выберите действие:
   - Включить/отключить для пользователя
   - Удалить индивидуальную настройку

## Настройка доступа

Для получения доступа к админке добавьте свой Telegram ID в переменную окружения:

```bash
ADMIN_USER_IDS=123456789,987654321
```

Где `123456789` - ваш Telegram ID.

## Приоритет настроек

1. **Индивидуальная настройка пользователя** - имеет наивысший приоритет
2. **Глобальная настройка** - применяется, если нет индивидуальной
3. **По умолчанию** - все сервисы включены, если нет настроек

## Примеры использования

### Отключить /set_cashback для всех
1. `/admin_services`
2. Выберите "Установка кэшбэка"
3. Нажмите "Отключить глобально"

### Включить /set_cashback только для разработчика
1. `/admin_services`
2. Выберите "Установка кэшбэка"
3. Нажмите "Настройки для пользователя"
4. Введите свой Telegram ID
5. Нажмите "Включить для пользователя"

### Просмотр статуса всех сервисов
1. `/admin_services`
2. Нажмите "Статус всех сервисов"

## Логирование

Все действия админки логируются с указанием:
- ID администратора
- Тип сервиса
- Действие (включить/отключить)
- Область действия (глобальная/пользовательская)

## Безопасность

- Доступ только для пользователей из `ADMIN_USER_IDS`
- Все действия логируются
- Middleware проверяет доступность сервисов перед выполнением
- Индивидуальные настройки переопределяют глобальные

## Техническая реализация

- **Entity**: `AdminSettings` - хранение настроек
- **Repository**: `AdminSettingsRepository` - работа с базой данных
- **Service**: `AdminSettingsService` - бизнес-логика
- **Controller**: `AdminController` - обработка команд
- **Middleware**: `createServiceAccessMiddleware` - проверка доступа
